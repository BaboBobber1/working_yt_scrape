<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto YouTube Harvester</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="app" id="app">
      <header class="app-header">
        <div>
          <h1>Crypto YouTube Harvester</h1>
          <p class="app-tagline">Organize, filter and manage outreach-ready channels.</p>
        </div>
        <div class="header-actions">
          <button
            type="button"
            class="icon-button help-button"
            id="helpBtn"
            aria-label="Open in-app documentation"
            title="Open in-app documentation"
          >
            ‚ÑπÔ∏è
          </button>
          <div class="quick-stats" id="quickStats">
            <span class="quick-stats__loading">Loading stats‚Ä¶</span>
          </div>
        </div>
      </header>

      <section class="discover-panel">
        <div class="discover-controls">
          <div class="discover-primary">
            <button class="btn btn--green btn--xl" id="discoverBtn" type="button">
              <span class="btn-icon">üîç</span>
              Discover
            </button>
          </div>
          <p class="discover-summary" id="discoverSummary">
            Configure discovery keywords and filters to get started.
          </p>
        </div>
        <div class="discover-utilities">
          <div class="action-group">
            <button
              class="btn btn--green btn--menu"
              id="importExportToggle"
              type="button"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <span class="btn-icon">üì¶</span>
              Import / Export
              <span class="btn-caret">‚ñæ</span>
            </button>
            <div class="dropdown-menu" id="importExportMenu" role="menu" hidden>
              <button class="dropdown-menu__item" id="exportCsvBtn" type="button">
                <span class="btn-icon">‚¨áÔ∏è</span>
                Export CSV
              </button>
              <button class="dropdown-menu__item" id="exportBundleBtn" type="button">
                <span class="btn-icon">üß∞</span>
                Export bundle
              </button>
              <button class="dropdown-menu__item" id="importBlacklistBtn" type="button">
                <span class="btn-icon">üì•</span>
                Import blacklist (CSV)
              </button>
            </div>
          </div>
          <div class="action-group">
            <button class="btn btn--green btn--xl" id="enrichBtn" type="button">
              <span class="btn-icon">‚öôÔ∏è</span>
              Enrich
            </button>
            <p class="action-subtext" id="enrichLastUsed">Last used: Full enrichment</p>
          </div>
        </div>
        <div class="discover-runner">
          <button class="btn btn--red" id="discoverStopBtn" hidden>
            <span class="btn-icon">‚èπÔ∏è</span>Stop discovery loop
          </button>
          <span class="discover-runner__counter" id="discoverRunCounter" hidden>
            Runs: 0 ‚Ä¢ New channels: 0
          </span>
        </div>
        <div class="discover-toggles">
          <label class="discover-toggle"><input type="checkbox" id="enrichNeverToggle" /> Never re-enrich</label>
          <label class="discover-toggle"><input type="checkbox" id="enrichForceToggle" /> Force run</label>
        </div>
        <div class="status-container">
          <div class="system-status" id="systemStatusBar" aria-live="polite">
            <span class="system-status__item">
              <span class="system-status__indicator system-status__indicator--idle"></span>
              <span>Collecting system status‚Ä¶</span>
            </span>
          </div>
          <div class="status-bar" id="statusBar" hidden></div>
          <div class="status-bar status-bar--info" id="progressBar" hidden></div>
          <div class="status-bar" id="summaryBar" hidden></div>
        </div>
      </section>

      <nav class="tab-navigation">
        <button class="tab is-active" data-category="active">Active</button>
        <button class="tab" data-category="archived">Archived</button>
        <button class="tab" data-category="blacklisted">Blacklisted</button>
      </nav>

      <section class="filters">
        <div class="filter-grid">
          <div class="filter-field">
            <label for="filterQuery">Search</label>
            <input type="text" id="filterQuery" placeholder="Name, URL, email" />
          </div>
          <div class="filter-field">
            <label for="filterLanguages">Languages</label>
            <input type="text" id="filterLanguages" placeholder="e.g. en, de, es" />
          </div>
          <div class="filter-field filter-field--range">
            <label>Subscribers</label>
            <div class="range-inputs">
              <input type="number" id="filterMinSubs" placeholder="Min" min="0" />
              <span>‚Äì</span>
              <input type="number" id="filterMaxSubs" placeholder="Max" min="0" />
            </div>
          </div>
          <fieldset class="filter-field filter-field--status">
            <legend>Status</legend>
            <div class="status-grid">
              <label class="status-option"><input type="checkbox" name="statusFilter" value="new" /> New</label>
              <label class="status-option"><input type="checkbox" name="statusFilter" value="processing" /> Processing</label>
              <label class="status-option"><input type="checkbox" name="statusFilter" value="completed" /> Completed</label>
              <label class="status-option"><input type="checkbox" name="statusFilter" value="error" /> Error</label>
            </div>
          </fieldset>
        </div>
        <div class="filter-toggles">
          <label class="filter-toggle"><input type="checkbox" id="filterEmailsOnly" /> Emails only</label>
          <label class="filter-toggle"><input type="checkbox" id="filterUniqueEmails" disabled /> Unique emails</label>
          <label class="filter-toggle"><input type="checkbox" id="filterTelegramOnly" /> Has Telegram</label>
          <label class="filter-toggle" hidden><input type="checkbox" id="filterEmailGateOnly" /> Email gate only</label>
        </div>
      </section>

      <section class="table-panel">
        <div class="table-header">
          <div>
            <h2 id="tableTitle">Active channels</h2>
            <p class="table-subtitle" id="tableSubtitle">Fresh leads waiting for outreach.</p>
          </div>
          <div class="header-actions">
            <button class="btn btn--yellow" id="bulkPrimaryBtn">üü° Archive (filtered)</button>
            <button class="btn btn--red" id="bulkSecondaryBtn">üî¥ Blacklist (filtered)</button>
          </div>
        </div>
        <div class="table-toolbar">
          <div class="table-sort">
            <label for="sortSelect">Sort</label>
            <select id="sortSelect">
              <option value="created_at">Newest</option>
              <option value="name">Name</option>
              <option value="subscribers">Subscribers</option>
              <option value="language">Language</option>
              <option value="last_updated">Last updated</option>
              <option value="exported_at">Exported</option>
              <option value="archived_at">Archived</option>
              <option value="status">Status</option>
              <option value="last_status_change">Status change</option>
            </select>
            <label for="orderSelect">Order</label>
            <select id="orderSelect">
              <option value="desc">Descending</option>
              <option value="asc">Ascending</option>
            </select>
          </div>
          <div class="table-meta" id="tableStatus"></div>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Subscribers</th>
                <th>Language</th>
                <th>Emails</th>
                <th>Telegram</th>
                <th>Status</th>
                <th>Last updated</th>
                <th>Exported</th>
                <th>Archived</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <tr>
                <td colspan="10" class="table-loading">Loading channels‚Ä¶</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pagination">
          <button class="btn btn--outline" id="prevPageBtn">‚Üê Previous</button>
          <span id="paginationLabel">Page 1 of 1</span>
          <button class="btn btn--outline" id="nextPageBtn">Next ‚Üí</button>
        </div>
      </section>
    </div>

    <div class="modal" id="helpModal" hidden aria-hidden="true">
      <div
        class="modal-content modal-content--wide modal-content--tall"
        role="dialog"
        aria-modal="true"
        aria-labelledby="helpModalTitle"
      >
        <div class="modal-header">
          <div class="modal-header__text">
            <h2 id="helpModalTitle">System guide</h2>
            <p class="modal-subtitle">How discovery, enrichment and automation work under the hood.</p>
          </div>
          <button type="button" class="modal-close" id="helpModalClose" aria-label="Close">√ó</button>
        </div>
        <div class="modal-body modal-body--scroll">
          <section class="modal-section">
            <h3 class="modal-section__title">Overview</h3>
            <p>
              Crypto YouTube Harvester is a single-page dashboard that discovers crypto-focused YouTube channels,
              enriches them with language + email intel, and organizes them into active, archived and blacklisted
              collections. Everything runs locally through the bundled FastAPI backend and SQLite database.
            </p>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Discovery workflow</h3>
            <ul>
              <li>Keywords are expanded line-by-line (commas are also accepted) and normalized before each run.</li>
              <li>Each keyword triggers paginated YouTube searches; paging tokens and page indexes are persisted per keyword so reruns continue where they left off.</li>
              <li>Search spans both channel matches and videos (titles, descriptions, tags); video hits feed their channel IDs through the same de-duped discovery flow.</li>
              <li>Optional limits include <em>per keyword</em> result caps, deny-language lists, subscriber minimums, public-upload minimums, and "last upload max age" (skips channels with stale or missing activity).</li>
              <li>Discovery can run once or continuously via "run until stopped"; continuous mode stops if several pages return no new channels or when safety caps are hit.</li>
              <li>Channel references are sanitized (IDs, handles, user/c paths, hyperlinks) and resolved to canonical URLs + IDs before they are accepted.</li>
              <li>Duplicates are rejected across all categories (active, archived, blacklisted) so the dataset stays unique.</li>
              <li>Channels without public uploads, with too few uploads, or below the subscriber floor are discarded/blacklisted before reaching the Active list.</li>
              <li>When auto-enrich is enabled, newly discovered channels immediately queue enrichment with the selected mode (email-only or full).</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Channel states &amp; categories</h3>
            <ul>
              <li>Logical collections: <strong>Active</strong> (default), <strong>Archived</strong> (paused/finished), and <strong>Blacklisted</strong> (hidden from future discovery).</li>
              <li>Status flags per channel: <code>new</code>, <code>processing</code>, <code>completed</code>, or <code>error</code>, plus timestamps for the last status change and enrichment attempts.</li>
              <li>Archiving/blacklisting moves rows between dedicated tables while preserving metadata, emails, and timestamps.</li>
              <li>Exported timestamps mark when a channel left the dashboard via CSV/bundle download.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Enrichment pipeline</h3>
            <ul>
              <li>Jobs run in batches (configurable limit) and stream live progress via server-sent events; the UI shows totals, errors, and pending counts.</li>
              <li>Modes: <strong>Full</strong> (emails from channel + recent videos, precise + fast language detection, metadata + activity refresh) or <strong>Email-only</strong> (channel emails only).</li>
              <li>Language detection blends channel text, recent video titles/descriptions, default audio languages, and caption tracks into a majority vote with stored confidence.</li>
              <li>Email extraction inspects channel pages and recent video descriptions; a gate flag notes when YouTube hides emails behind a form.</li>
              <li>Skipped channels: recent "no email" results are remembered for 30 days to avoid redundant work.</li>
              <li>Scopes: current filter vs all active rows; force-run and "never re-enrich" toggles control whether completed channels are eligible.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Automation &amp; notifications</h3>
            <ul>
              <li>Continuous discovery reports start/stop/progress events to the backend; the UI mirrors counts (runs, new channels) and exposes a stop control.</li>
              <li>Auto-enrich queues enrichment after each discovery pass and chains additional runs until the queue is drained.</li>
              <li>System status bar announces the latest action, errors, and completion summaries.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Filtering, sorting &amp; paging</h3>
            <ul>
              <li>Filters include free-text search (name/URL/email), language codes, subscriber min/max, statuses, "emails only", "unique emails", and "email gate only".</li>
              <li>Sorting covers creation time, name, subscribers, language, last update, export/archival dates, and status timestamps; order can be asc/desc.</li>
              <li>Pagination uses a fixed page size (default 50) with offset-based navigation; controls update counts and page labels live.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Data storage &amp; exports</h3>
            <ul>
              <li>SQLite database: separate tables per category plus auxiliary tables for blacklist entries and unique email tracking.</li>
              <li>Channel records capture IDs, canonical URLs, subscribers, language + confidence, email list, gate flag, status metadata, and audit timestamps.</li>
              <li>Export options: CSV snapshot or project bundle; exports mark rows with an <code>exported_at</code> timestamp.</li>
              <li>Blacklist import accepts CSVs with <code>channel_id</code> or <code>url</code>; duplicates are skipped and results are summarized in-app.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Error handling &amp; safeguards</h3>
            <ul>
              <li>Invalid inputs (e.g., subscriber ranges, statuses, malformed keywords) return clear validation errors before any work begins.</li>
              <li>Discovery automatically skips failed keyword pages and resumes later using stored page tokens.</li>
              <li>Enrichment continues even when individual channels fail; errors are stored per channel and surfaced in the status column.</li>
              <li>Rate safety: continuous discovery caps pages and new-channel counts per run to prevent runaway loops.</li>
            </ul>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">FAQ / Q&amp;A</h3>
            <div class="accordion" role="list">
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Wie funktioniert Discovery intern?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Pro Keyword wird direkt die YouTube-Suche mit Channel-Filter (<code>sp=EgIQAg%3D%3D</code>) aufgerufen; es werden ausschlie√ülich Kan√§le geholt, keine Videos. Treffer werden normalisiert (ID, Handle, /c-/user-Pfade) und gegen Blacklist + bestehende Daten gepr√ºft, bevor sie gespeichert werden.
                  </p>
                  <p>
                    F√ºr Deny-Languages und ‚ÄûLast upload max age‚Äú wird vor dem Einf√ºgen ein leichtgewichtiges RSS/Watch-Metadataset geladen, um Sprache und letztes Upload-Datum zu bestimmen; Verst√∂√üe werden sofort geblacklistet und nicht √ºbernommen.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Wie werden Keywords ausgewertet?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Keywords werden im Dialog zeilen- oder kommasepariert erfasst, getrimmt und ohne weitere Aufsplittung an die YouTube-Suche √ºbergeben. Dadurch wird nach Kan√§len gesucht, deren Name/Beschreibung/Tags auf die ganze Phrase matchen; l√§ngere Phrasen funktionieren, liefern aber oft weniger Seiten als k√ºrzere, generische Begriffe.
                  </p>
                  <p>
                    Da ausschlie√ülich Kanal-Suchergebnisse verarbeitet werden, kommen Treffer nicht aus Videolisten und werden auch nicht erst aus Video-Treffern auf Kan√§le r√ºckgeschlossen.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Was bedeutet ‚ÄûPer keyword‚Äú im Discover-Dialog?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Der Wert begrenzt pro Keyword, wie viele neue Kan√§le pro Run geholt und gespeichert werden. Im Standardlauf stoppt Discovery pro Keyword, sobald die Zahl erreicht ist. In ‚ÄûRun until stopped‚Äú wird das Limit zus√§tzlich durch Sicherheitskappen gedeckelt (max. 200 neue Kan√§le bzw. 20 Seiten pro Run) und nach jeder Seite mit einem persistierten Page-Token fortgef√ºhrt.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Was macht ‚ÄûRun until stopped‚Äú genau?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Diese Option zwingt Discovery in einen Loop f√ºr genau ein Keyword. Pro Durchlauf werden gespeicherte Paging-Offsets, Page-Index und ein ‚Äûkeine neuen Treffer‚Äú-Z√§hler geladen. Der Loop verarbeitet Seiten, bis das Limit erreicht ist, kein Token mehr vorliegt oder mehrere Seiten hintereinander keine neuen Kan√§le liefern. Nach jedem Durchlauf werden Offsets und Exhausted-Flags pro Keyword gespeichert; das UI zeigt Runs und New-Counts und l√§sst den Loop stoppbar weiterlaufen.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Wie funktioniert ‚ÄûDeny languages‚Äú?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    F√ºr jede Kandidatin wird w√§hrend der Discovery ein RSS-Feed + j√ºngstes Video geladen und eine Sprachdetektion √ºber Titel, Beschreibung und Watch-Details gefahren. Treffer mit einer Sprache aus der Deny-Liste werden sofort geblacklistet (inkl. Grund) und gar nicht erst in die Kategorien geschrieben. Der Filter greift damit schon in der Discovery-Phase, bevor sp√§teres Enrichment ins Spiel kommt.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Wie arbeitet Auto-Enrich beim Discovern?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Auto-Enrich nutzt die global gespeicherten Enrichment-Settings (Email-Mode, Language-Mode, Metadata/Activity-Flags) und startet nach jedem Discover-Run automatisch einen Enrich-Job f√ºr die neu gefundenen Kan√§le (Scope: alle aktiven). L√§uft bereits ein Enrichment, werden die Counts gepuffert und nach Abschluss automatisch nachgezogen.</p>
                  <p>
                    Limit- und Skip-Logik bleiben erhalten: ‚ÄûNever re-enrich‚Äú respektiert die Checkbox im Discover-Panel, und Channels mit j√ºngsten ‚Äûno email‚Äú-Ergebnissen werden serverseitig √ºbersprungen.</p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Was ist der Unterschied zwischen ‚ÄûCurrent filter only‚Äú und ‚ÄûAll active channels‚Äú beim Enrich?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    ‚ÄûCurrent filter only‚Äú √ºbergibt die aktuell angewendeten Tabellenfilter (Suche, Sprache, Status, E-Mail-Flags) an den Enrich-Endpunkt; nur die gefilterte Auswahl wird abgearbeitet. ‚ÄûAll active channels‚Äú ignoriert UI-Filter und startet den Job √ºber die gesamte Active-Kategorie. In beiden F√§llen steuern die Toggles ‚ÄûForce run‚Äú und ‚ÄûNever re-enrich‚Äú, ob bereits angereicherte Kan√§le erneut ber√ºcksichtigt werden.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Wie funktionieren ‚ÄûUnique emails‚Äú und ‚ÄûEmail gate only‚Äú?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    ‚ÄûEmail gate only‚Äú filtert Tabellenzeilen auf Kan√§le mit erkanntem E-Mail-Gate-Flag. ‚ÄûUnique emails‚Äú wird nur aktiv, wenn auch ‚ÄûEmails only‚Äú gesetzt ist; der Backend-Query liefert dann pro E-Mail genau einen Prim√§rkanal (inkl. Verweis auf weitere Vorkommen) aus der aktuellen Kategorie und respektiert dabei Filter wie Sprache oder Status. Archivierte/Blacklisted Channels bleiben damit au√üen vor, beeinflussen aber weiterhin die globale Unique-E-Mail-Tabelle f√ºr sp√§tere Abgleiche.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Was passiert beim Blacklisten / Archivieren?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <p>
                    Blacklisting verschiebt Kan√§le in die Blacklist-Tabelle und markiert sie zus√§tzlich mit Status ‚Äûblacklisted‚Äú. Discovery pr√ºft diese Tabelle vor jedem Insert und √ºberspringt solche IDs dauerhaft. Archivieren verschiebt Zeilen in die Archiv-Tabelle, beh√§lt Metadaten und E-Mails und verhindert doppelte Wiederentdeckungen, da Discovery alle vorhandenen Kan√§le (auch archivierte) als ‚Äûknown‚Äú behandelt.
                  </p>
                </div>
              </details>
              <details class="accordion-item" role="listitem">
                <summary>
                  <span class="accordion-title">Gibt es weitere Limits oder Sicherungen?</span>
                  <span class="accordion-icon" aria-hidden="true">‚ñæ</span>
                </summary>
                <div class="accordion-content">
                  <ul>
                    <li><strong>Enrich limit</strong>: Wenn gesetzt, schr√§nkt Discovery die Auto-Enrich-Queue auf diese Anzahl neuer Kan√§le pro Run ein.</li>
                    <li><strong>Exports/Backups</strong>: CSV-Export markiert Zeilen mit <code>exported_at</code>; Bundle-Export speichert alle Kategorien, Blacklist und Unique-Emails, Bundle-Import stellt diese Strukturen wieder her.</li>
                    <li><strong>Never re-enrich</strong>: Der Toggle im Discover-Panel wird beim Enrichment-Request mitgeschickt und verhindert, dass k√ºrzlich angereicherte Kan√§le erneut gestartet werden.</li>
                  </ul>
                </div>
              </details>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div class="modal" id="discoverSettingsModal" hidden>
      <div
        class="modal-content modal-content--wide"
        role="dialog"
        aria-modal="true"
        aria-labelledby="discoverSettingsTitle"
      >
        <div class="modal-header">
          <h2 id="discoverSettingsTitle">Discover settings</h2>
          <button type="button" class="modal-close" id="discoverSettingsCloseBtn" aria-label="Close">√ó</button>
        </div>
        <form class="modal-body discover-modal-body" id="discoverSettingsForm">
          <section class="modal-section">
            <h3 class="modal-section__title">Keywords</h3>
            <div class="modal-field">
              <label for="discoverKeywords">Discovery keywords</label>
              <textarea id="discoverKeywords" rows="6" spellcheck="false"></textarea>
              <p class="modal-hint">Enter one keyword per line or separate them with commas.</p>
            </div>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Limits &amp; filters</h3>
            <div class="modal-grid">
              <div class="modal-field">
                <label for="discoverPerKeyword">Per keyword</label>
                <input type="number" id="discoverPerKeyword" min="1" />
              </div>
              <div class="modal-field">
                <label for="discoverMinSubscribers">Min subscribers</label>
                <input type="number" id="discoverMinSubscribers" min="0" placeholder="0" />
                <p class="modal-hint">Drop channels below this subscriber floor.</p>
              </div>
              <div class="modal-field">
                <label for="discoverMinPublicUploads">Min public uploads</label>
                <input type="number" id="discoverMinPublicUploads" min="0" placeholder="0" />
                <p class="modal-hint">Channels with missing/hidden uploads are discarded immediately.</p>
              </div>
              <div class="modal-field">
                <label for="discoverLastUploadMaxAge">Last upload max age (days)</label>
                <input type="number" id="discoverLastUploadMaxAge" min="0" placeholder="No limit" />
                <p class="modal-hint">Channels without public videos fail this filter automatically.</p>
              </div>
              <div class="modal-field modal-field--full">
                <label for="discoverDenyLanguages">Deny languages</label>
                <input
                  type="text"
                  id="discoverDenyLanguages"
                  placeholder="e.g. de, fr, ru"
                  spellcheck="false"
                />
                <p class="modal-hint">Comma separated language codes. Leave blank to allow all.</p>
              </div>
            </div>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Automation</h3>
            <div class="modal-switches">
              <label class="modal-toggle">
                <input type="checkbox" id="discoverRunUntilStopped" /> Run until stopped
              </label>
              <div class="modal-field modal-field--inline">
                <label class="modal-toggle">
                  <input type="checkbox" id="discoverAutoEnrichToggle" /> Auto-enrich discovered channels
                </label>
                <p class="modal-hint">
                  Auto-enrich uses the saved enrichment settings (same as the Enrich button).
                </p>
                <button type="button" class="btn btn--outline" id="discoverOpenEnrichmentSettings">
                  Open enrichment settings‚Ä¶
                </button>
              </div>
              <div class="modal-field">
                <label for="enrichLimit">Enrich limit (optional)</label>
                <input type="number" id="enrichLimit" min="1" placeholder="No limit" />
              </div>
            </div>
          </section>
        </form>
        <div class="modal-footer">
          <button type="button" class="btn btn--outline" id="discoverSettingsCancelBtn">Cancel</button>
          <button type="submit" form="discoverSettingsForm" class="btn btn--green" id="discoverSettingsStartBtn">
            <span class="btn-icon">üîç</span>Start discovery
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="enrichSettingsModal" hidden aria-hidden="true">
      <div
        class="modal-content modal-content--wide"
        role="dialog"
        aria-modal="true"
        aria-labelledby="enrichSettingsTitle"
      >
        <div class="modal-header">
          <h2 id="enrichSettingsTitle">Enrichment settings</h2>
          <button type="button" class="modal-close" id="enrichSettingsCloseBtn" aria-label="Close">√ó</button>
        </div>
        <form class="modal-body discover-modal-body" id="enrichSettingsForm">
          <section class="modal-section" id="enrichScopeSection">
            <h3 class="modal-section__title">Scope</h3>
            <div class="modal-switches">
              <label class="modal-toggle">
                <input type="radio" name="enrichScope" id="enrichScopeFiltered" value="filtered" checked />
                Current filter only
              </label>
              <label class="modal-toggle">
                <input type="radio" name="enrichScope" id="enrichScopeAllActive" value="all_active" />
                All active channels
              </label>
            </div>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Email enrichment</h3>
            <div class="modal-switches">
              <label class="modal-toggle">
                <input type="checkbox" id="enrichEmailsEnabled" />
                Enable email enrichment
              </label>
              <label class="modal-toggle modal-select">
                <span>Email search mode</span>
                <select id="enrichEmailsMode">
                  <option value="channel_and_videos">Channel + recent video descriptions (full)</option>
                  <option value="channel_only">Channel description only (fast)</option>
                  <option value="videos_only">Recent video descriptions only</option>
                </select>
              </label>
            </div>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Language detection</h3>
            <div class="modal-switches">
              <label class="modal-toggle">
                <input type="checkbox" id="enrichLanguageEnabled" />
                Enable language detection
              </label>
              <label class="modal-toggle modal-select">
                <span>Language detection mode</span>
                <select id="enrichLanguageMode">
                  <option value="fast">Fast (basic only)</option>
                  <option value="precise">Precise (slower, more accurate)</option>
                </select>
              </label>
            </div>
          </section>
          <section class="modal-section">
            <h3 class="modal-section__title">Other steps</h3>
            <div class="modal-switches">
              <label class="modal-toggle">
                <input type="checkbox" id="enrichUpdateMetadata" />
                Refresh channel metadata
              </label>
              <label class="modal-toggle">
                <input type="checkbox" id="enrichUpdateActivity" />
                Update last upload/activity
              </label>
              <label class="modal-toggle">
                <input type="checkbox" id="enrichTelegramEnabled" />
                Enable Telegram enrichment
              </label>
            </div>
          </section>
        </form>
        <div class="modal-footer">
          <button type="button" class="btn btn--outline" id="enrichSettingsCancelBtn">Cancel</button>
          <button type="submit" form="enrichSettingsForm" class="btn btn--green" id="enrichSettingsStartBtn">
            <span class="btn-icon">‚öôÔ∏è</span>Start enrichment
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="blacklistModal" hidden>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="blacklistTitle">
        <div class="modal-header">
          <h2 id="blacklistTitle">Import blacklist</h2>
          <button type="button" class="modal-close" id="blacklistCloseBtn" aria-label="Close">√ó</button>
        </div>
        <form class="modal-body" id="blacklistForm">
          <div class="modal-field">
            <label for="blacklistFile">CSV file</label>
            <input type="file" id="blacklistFile" accept=".csv,text/csv" required />
            <p class="modal-hint">Accepted columns: <code>channel_id</code> or <code>url</code>. Additional columns are ignored.</p>
          </div>
          <div class="modal-actions">
            <button type="submit" class="btn btn--red" id="blacklistSubmitBtn">Import</button>
            <button type="button" class="btn btn--outline" id="blacklistCancelBtn">Cancel</button>
          </div>
        </form>
        <div class="modal-summary" id="blacklistSummary"></div>
      </div>
    </div>

    <script type="module" src="/static/app.js"></script>
  </body>
</html>
